---
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";
import Button from "@components/ui/button.astro";
import { loadStripe } from "@stripe/stripe-js";
---

const stripePromise = loadStripe("pk_live_51Q8tiiD3zf1H8CLSz1p44ij9VcimA1ZyWqyHknXNsd2wNJqvY2GxTIE5QG0410dyS9512jiycdSBLgFjgidoQzvz00GAtZMlHu");

<Layout title="Book Our Services">
  <Container>
    <section class="py-16 bg-background">
      <h2 class="text-4xl font-bold text-primary text-center mb-12">Instantly Book Our Services</h2>
      <p class="text-lg text-center text-textDark max-w-2xl mx-auto mb-12">
        We now offer instant booking for some of our most popular services. Select a service below to schedule and pay conveniently with Apple Pay.
      </p>
      <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition text-center">
          <h4 class="text-2xl font-bold text-primary mb-4">Landscaping</h4>
          <p class="text-textDark mb-6">Transform your outdoor space with our expert landscaping services.</p>
          <Button
            onClick={() => handleBooking("prod_R0vscIVM5pEp7y")} // Replace "price_12345" with your actual price ID
            type="button"
            class="bg-accent1 text-white hover:bg-accent2 inline-block px-8 py-4 rounded-full font-bold"
          >
            Book Now
          </Button>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition text-center">
          <h4 class="text-2xl font-bold text-primary mb-4">Mowing</h4>
          <p class="text-textDark mb-6">Keep your lawn looking pristine with our regular mowing services.</p>
          <Button
            onClick={() => handleBooking("prod_R0vscIVM5pEp7y")} // Replace "price_67890" with your actual price ID
            type="button"
            class="bg-accent1 text-white hover:bg-accent2 inline-block px-8 py-4 rounded-full font-bold"
          >
            Book Now
          </Button>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition text-center">
          <h4 class="text-2xl font-bold text-primary mb-4">Tree Planting</h4>
          <p class="text-textDark mb-6">Add beauty and value to your property with our tree planting services.</p>
          <Button
            onClick={() => handleBooking("prod_R0vscIVM5pEp7y")} // Replace "price_abcde" with your actual price ID
            type="button"
            class="bg-accent1 text-white hover:bg-accent2 inline-block px-8 py-4 rounded-full font-bold"
          >
            Book Now
          </Button>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition text-center">
          <h4 class="text-2xl font-bold text-primary mb-4">General Maintenance</h4>
          <p class="text-textDark mb-6">Book our maintenance services to keep your property in top shape.</p>
          <Button
            onClick={() => handleBooking("prod_R0vscIVM5pEp7y")} // Replace "price_fghij" with your actual price ID
            type="button"
            class="bg-accent1 text-white hover:bg-accent2 inline-block px-8 py-4 rounded-full font-bold"
          >
            Book Now
          </Button>
        </div>
      </div>
    </section>
  </Container>
</Layout>

<script>
  async function handleBooking(priceId) {
    const stripe = await stripePromise;
    const response = await fetch("/create-payment-intent", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ amount: 5000 }) // Adjust the amount accordingly
    });

    const { clientSecret } = await response.json();

    const result = await stripe.redirectToCheckout({
      mode: "payment",
      lineItems: [{ price: priceId, quantity: 1 }],
      successUrl: `${window.location.origin}/success`,
      cancelUrl: `${window.location.origin}/cancel`
    });

    if (result.error) {
      console.error(result.error.message);
    }
  }
</script>
